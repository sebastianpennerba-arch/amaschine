<!DOCTYPE html>
<html>
<head><title>Meta Auth</title></head>
<body>
<script>
  // 1) Code aus der URL holen
  const params = new URLSearchParams(window.location.search);
  const code = params.get("code");

  if (!code) {
    window.close();
  }

  // 2) Code → Token über dein Backend austauschen
  fetch("/api/meta-auth?code=" + code)
    .then(r => r.json())
    .then(data => {
      // 3) Token ans Hauptfenster senden
      if (data.access_token) {
        window.opener.postMessage(
          { access_token: data.access_token },
          "*"    // wichtig!
        );
      } else {
        window.opener.postMessage(
          { error: "token_failed" },
          "*"
        );
      }

      // 4) Popup schließen
      window.close();
    })
    .catch(() => {
      window.opener.postMessage(
        { error: "token_failed" },
        "*"
      );
      window.close();
    });
</script>

<p>Meta Login erfolgreich.</p>
</body>
</html>
