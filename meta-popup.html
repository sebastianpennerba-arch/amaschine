<!DOCTYPE html>
<html>
<head>
  <title>Meta Auth</title>
</head>
<body>
<script>
  const params = new URLSearchParams(window.location.search);
  const code = params.get("code");

  if (!code) {
    window.opener.postMessage({ error: "NO_CODE" }, "*");
    window.close();
  }

  fetch("/api/meta-auth?code=" + code)
    .then(res => res.json())
    .then(data => {
      if (data.access_token) {
        window.opener.postMessage(
          { access_token: data.access_token },
          "*"
        );
      } else {
        window.opener.postMessage({ error: "TOKEN_EXCHANGE_FAILED" }, "*");
      }
      window.close();
    })
    .catch(err => {
      window.opener.postMessage({ error: "REQUEST_FAILED" }, "*");
      window.close();
    });
</script>

<p>Meta Login erfolgreich. Dieses Fenster kann geschlossen werden.</p>
</body>
</html>
